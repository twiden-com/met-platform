<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medha Code - Practice Coding</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-navy: #1e3a8a;
            --color-orange: #f97316;
            --color-white: #ffffff;
            --color-gray-bg: #f2f4f8;
            --color-border: #e0e0e0;
            --color-text-primary: #161616;
            --color-text-secondary: #6f6f6f;
            --color-blue: #0f62fe;
            --color-green: #24a148;
            --color-red: #da1e28;
            --color-yellow: #f1c21b;
            --color-purple: #8a3ffc;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'IBM Plex Sans', sans-serif;
            background: var(--color-gray-bg);
            min-height: 100vh;
        }

        .app-header {
            background: var(--color-navy);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.15s ease;
            padding: 0.5rem;
            border-radius: 4px;
        }

        .back-link:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }

        .page-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: white;
            margin: 0;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            letter-spacing: -0.02em;
        }

        .logo-accent {
            color: var(--color-orange);
        }

        /* Main Layout - Three Column Layout */
        .main-container {
            display: grid;
            grid-template-columns: 350px 1fr 400px;
            height: calc(100vh - 72px);
            overflow: hidden;
        }

        /* Column 1: Questions List */
        .questions-column {
            background: white;
            border-right: 1px solid var(--color-border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .questions-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--color-border);
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }

        .questions-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--color-text-primary);
            margin: 0 0 1rem 0;
        }

        .course-dropdown {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            color: var(--color-text-primary);
            background: white;
            transition: all 0.15s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }

        .course-dropdown:focus {
            outline: none;
            border-color: var(--color-blue);
            box-shadow: 0 0 0 3px rgba(15, 98, 254, 0.1);
        }

        .questions-list {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .question-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.15s ease;
            position: relative;
        }

        .question-card:hover {
            border-color: var(--color-blue);
            box-shadow: 0 2px 8px rgba(15, 98, 254, 0.1);
            transform: translateY(-1px);
        }

        .question-card.selected {
            border-color: var(--color-blue);
            background: rgba(15, 98, 254, 0.05);
        }

        .question-difficulty {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .difficulty-easy {
            background: #d1fae5;
            color: #059669;
        }

        .difficulty-medium {
            background: #fef3c7;
            color: #d97706;
        }

        .difficulty-hard {
            background: #fee2e2;
            color: #dc2626;
        }

        .question-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--color-text-primary);
            margin: 0 0 0.5rem 0;
            padding-right: 4rem;
        }

        .question-description {
            font-size: 0.75rem;
            color: var(--color-text-secondary);
            line-height: 1.4;
            margin: 0 0 0.75rem 0;
        }

        .question-tags {
            display: flex;
            gap: 0.25rem;
            flex-wrap: wrap;
        }

        .question-tag {
            background: #f3f4f6;
            color: #6b7280;
            padding: 0.125rem 0.375rem;
            border-radius: 4px;
            font-size: 0.625rem;
            font-weight: 500;
        }

        /* Column 2: Content Area with Tabs */
        .content-column {
            background: white;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .content-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--color-border);
            background: #fafbfc;
        }

        .content-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--color-text-primary);
            margin: 0 0 1rem 0;
        }

        .tab-navigation {
            display: flex;
            gap: 0.5rem;
            border-bottom: 1px solid var(--color-border);
            margin-bottom: 1rem;
        }

        .tab-button {
            padding: 0.75rem 1.5rem;
            border: none;
            background: transparent;
            color: var(--color-text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.15s ease;
        }

        .tab-button.active {
            color: var(--color-blue);
            border-bottom-color: var(--color-blue);
            background: rgba(15, 98, 254, 0.05);
        }

        .tab-button:hover:not(.active) {
            color: var(--color-text-primary);
            background: #f3f4f6;
        }

        .content-container {
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        .tab-content {
            display: none;
            height: 100%;
            overflow: hidden;
        }

        .tab-content.active {
            display: block;
        }

        .content-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }

        .code-editor-placeholder {
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            text-align: center;
            color: var(--color-text-secondary);
            background: #f8f9fa;
        }

        .code-editor-icon {
            width: 64px;
            height: 64px;
            color: #d1d5db;
            margin-bottom: 1rem;
        }

        .code-editor-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--color-text-primary);
            margin: 0 0 0.5rem 0;
        }

        .code-editor-description {
            font-size: 0.875rem;
            line-height: 1.4;
        }

        /* Column 3: AI Chatbot */
        .chat-column {
            background: white;
            border-left: 1px solid var(--color-border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--color-border);
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            position: relative;
            overflow: hidden;
        }

        .chat-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--color-blue), var(--color-purple));
        }

        .chat-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--color-text-primary);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chat-icon {
            width: 20px;
            height: 20px;
            color: var(--color-blue);
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            background: #fafbfc;
        }

        .chat-message {
            display: flex;
            gap: 0.75rem;
            align-items: flex-start;
        }

        .chat-message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            flex-shrink: 0;
        }

        .message-avatar.user {
            background: var(--color-blue);
            color: white;
        }

        .message-avatar.assistant {
            background: var(--color-purple);
            color: white;
        }

        .message-content {
            max-width: 80%;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            font-size: 0.875rem;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .chat-message.user .message-content {
            background: var(--color-blue);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .chat-message.assistant .message-content {
            background: white;
            color: var(--color-text-primary);
            border: 1px solid var(--color-border);
            border-bottom-left-radius: 4px;
        }

        .message-content pre {
            background: rgba(0, 0, 0, 0.05);
            padding: 0.5rem;
            border-radius: 4px;
            overflow-x: auto;
            margin: 0.5rem 0;
        }

        .message-content code {
            background: rgba(0, 0, 0, 0.05);
            padding: 0.125rem 0.25rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.8em;
        }

        .chat-input-container {
            padding: 1rem;
            border-top: 1px solid var(--color-border);
            background: white;
        }

        .chat-input-wrapper {
            display: flex;
            gap: 0.5rem;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            min-height: 40px;
            max-height: 120px;
            padding: 0.75rem;
            border: 1px solid var(--color-border);
            border-radius: 20px;
            font-size: 0.875rem;
            font-family: inherit;
            resize: none;
            outline: none;
            transition: all 0.15s ease;
        }

        .chat-input:focus {
            border-color: var(--color-blue);
            box-shadow: 0 0 0 3px rgba(15, 98, 254, 0.1);
        }

        .chat-input::placeholder {
            color: var(--color-text-secondary);
        }

        .chat-send-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: var(--color-blue);
            color: white;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
            flex-shrink: 0;
        }

        .chat-send-btn:hover:not(:disabled) {
            background: #0353e9;
            transform: scale(1.05);
        }

        .chat-send-btn:disabled {
            background: #d1d5db;
            cursor: not-allowed;
            transform: none;
        }

        .chat-welcome {
            text-align: center;
            padding: 2rem;
            color: var(--color-text-secondary);
        }

        .chat-welcome-icon {
            width: 48px;
            height: 48px;
            color: var(--color-blue);
            margin: 0 auto 1rem;
        }

        .chat-welcome h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--color-text-primary);
            margin: 0 0 0.5rem 0;
        }

        .chat-welcome p {
            font-size: 0.875rem;
            line-height: 1.4;
            margin: 0;
        }

        .typing-indicator {
            display: flex;
            gap: 0.25rem;
            padding: 0.75rem 1rem;
            background: white;
            border: 1px solid var(--color-border);
            border-radius: 12px;
            border-bottom-left-radius: 4px;
            max-width: 80%;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--color-text-secondary);
            border-radius: 50%;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingAnimation {
            0%, 80%, 100% {
                opacity: 0.3;
                transform: scale(0.8);
            }
            40% {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Empty state */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 2rem;
            text-align: center;
            color: var(--color-text-secondary);
        }

        .empty-icon {
            width: 64px;
            height: 64px;
            color: #d1d5db;
            margin-bottom: 1rem;
        }

        .empty-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--color-text-primary);
            margin: 0 0 0.5rem 0;
        }

        .empty-description {
            font-size: 0.875rem;
            line-height: 1.4;
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .main-container {
                grid-template-columns: 320px 1fr 350px;
            }
        }

        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 300px 1fr 320px;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .questions-column, .chat-column {
                display: none;
            }
            
            .app-header {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- App Header -->
    <div class="app-header">
        <div class="header-left">
            <a href="/dashboard" class="back-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.42-1.41L7.83 13H20v-2z"/>
                </svg>
                Dashboard
            </a>
            <h1 class="page-title">Medha Code</h1>
        </div>
        <div class="logo">
            Medha<span class="logo-accent">EduTech</span>
        </div>
    </div>

    <!-- Main Container - Three Column Layout -->
    <div class="main-container">
        <!-- Column 1: Questions List -->
        <div class="questions-column">
            <div class="questions-header">
                <h2 class="questions-title">Coding Questions</h2>
                <select class="course-dropdown" id="course-select">
                    <option value="python_fullstack" selected>Python Full Stack</option>
                    <option value="all">All Courses</option>
                    <option value="digital_marketing">Digital Marketing</option>
                    <option value="cybersecurity">Cybersecurity</option>
                    <option value="java_fullstack">Java Full Stack</option>
                    <option value="data_science">Data Science</option>
                    <option value="data_analytics">Data Analytics</option>
                </select>
            </div>
            
            <div class="questions-list" id="questions-list">
                <!-- Questions will be loaded here -->
            </div>
        </div>

        <!-- Column 2: Content Area with Read/Code Tabs -->
        <div class="content-column">
            <div class="content-header">
                <h3 class="content-title">Learning Platform</h3>
                <div class="tab-navigation">
                    <button class="tab-button active" onclick="switchTab('read')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 0.5rem;">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                        </svg>
                        Read
                    </button>
                    <button class="tab-button" onclick="switchTab('code')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 0.5rem;">
                            <path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0L19.2 12l-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/>
                        </svg>
                        Code
                    </button>
                </div>
            </div>
            
            <div class="content-container">
                <!-- Read Tab Content -->
                <div id="read-tab" class="tab-content active">
                    <iframe 
                        class="content-iframe"
                        src="https://met.gitbook.io/python"
                        allow="fullscreen">
                    </iframe>
                </div>
                
                <!-- Code Tab Content -->
                <div id="code-tab" class="tab-content">
                    <div class="code-editor-placeholder">
                        <svg class="code-editor-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0L19.2 12l-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/>
                        </svg>
                        <h3 class="code-editor-title">Code Editor Coming Soon</h3>
                        <p class="code-editor-description">
                            The integrated code editor will be available here. You can practice coding directly in the browser with syntax highlighting, auto-completion, and real-time execution.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Column 3: AI Chatbot -->
        <div class="chat-column">
            <div class="chat-header">
                <h3 class="chat-title">
                    <svg class="chat-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                    </svg>
                    AI Coding Assistant
                </h3>
            </div>
            
            <div class="chat-container">
                <div class="chat-messages" id="chat-messages">
                    <div class="chat-welcome">
                        <svg class="chat-welcome-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                        </svg>
                        <h3>Welcome to AI Assistant!</h3>
                        <p>I'm here to help you with coding questions, explain concepts, debug issues, and provide guidance. Just type your question below to get started!</p>
                    </div>
                </div>
                
                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <textarea 
                            id="chat-input" 
                            class="chat-input" 
                            placeholder="Ask me anything.."
                            rows="1"></textarea>
                        <button id="chat-send-btn" class="chat-send-btn" onclick="sendMessage()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Puter.js -->
    <script src="https://js.puter.com/v2/"></script>
    
    <script>
        class MedhaCode {
            constructor() {
                this.selectedQuestion = null;
                this.questions = this.getSampleQuestions();
                this.chatMessages = [];
                this.isTyping = false;
                this.initializeEventListeners();
                this.loadQuestionsByCourse('python_fullstack'); // Default to Python Full Stack
                this.initializePuter();
            }

            async initializePuter() {
                try {
                    // Wait for Puter to be available
                    if (typeof puter !== 'undefined' && puter.ai) {
                        console.log('Puter.js loaded successfully');
                        this.addSystemMessage('MET AI Assistant ready!');
                    } else {
                        console.log('Waiting for Puter.js to load...');
                        setTimeout(() => this.initializePuter(), 1000);
                    }
                } catch (error) {
                    console.error('Error initializing Puter:', error);
                    this.addSystemMessage('AI Assistant ready!');
                }
            }

            initializeEventListeners() {
                const courseSelect = document.getElementById('course-select');
                courseSelect.addEventListener('change', (e) => {
                    this.loadQuestionsByCourse(e.target.value);
                });

                // Chat input listeners
                const chatInput = document.getElementById('chat-input');
                const sendBtn = document.getElementById('chat-send-btn');

                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });

                chatInput.addEventListener('input', () => {
                    // Auto-resize textarea
                    chatInput.style.height = 'auto';
                    chatInput.style.height = Math.min(chatInput.scrollHeight, 120) + 'px';
                });

                sendBtn.addEventListener('click', () => {
                    this.sendMessage();
                });
            }

            switchTab(tabName) {
                // Remove active class from all tabs and buttons
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                // Add active class to selected tab and button
                document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
                document.getElementById(`${tabName}-tab`).classList.add('active');
            }

            addSystemMessage(message) {
                const messagesContainer = document.getElementById('chat-messages');
                const welcomeDiv = messagesContainer.querySelector('.chat-welcome');
                if (welcomeDiv) {
                    welcomeDiv.remove();
                }

                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message assistant';
                messageDiv.innerHTML = `
                    <div class="message-avatar assistant">AI</div>
                    <div class="message-content">${message}</div>
                `;
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            addUserMessage(message) {
                const messagesContainer = document.getElementById('chat-messages');
                const welcomeDiv = messagesContainer.querySelector('.chat-welcome');
                if (welcomeDiv) {
                    welcomeDiv.remove();
                }

                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message user';
                messageDiv.innerHTML = `
                    <div class="message-avatar user">U</div>
                    <div class="message-content">${this.formatMessage(message)}</div>
                `;
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            addAssistantMessage(message) {
                const messagesContainer = document.getElementById('chat-messages');
                
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message assistant';
                messageDiv.innerHTML = `
                    <div class="message-avatar assistant">AI</div>
                    <div class="message-content">${this.formatMessage(message)}</div>
                `;
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            showTypingIndicator() {
                const messagesContainer = document.getElementById('chat-messages');
                
                const typingDiv = document.createElement('div');
                typingDiv.className = 'chat-message assistant';
                typingDiv.id = 'typing-indicator';
                typingDiv.innerHTML = `
                    <div class="message-avatar assistant">AI</div>
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                `;
                messagesContainer.appendChild(typingDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            hideTypingIndicator() {
                const typingIndicator = document.getElementById('typing-indicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            }

            formatMessage(message) {
                // Basic markdown-like formatting
                return message
                    .replace(/`([^`]+)`/g, '<code>$1</code>')
                    .replace(/```([^```]+)```/g, '<pre><code>$1</code></pre>')
                    .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*([^*]+)\*/g, '<em>$1</em>')
                    .replace(/\n/g, '<br>');
            }

            async sendMessage() {
                const input = document.getElementById('chat-input');
                const sendBtn = document.getElementById('chat-send-btn');
                const message = input.value.trim();

                if (!message || this.isTyping) return;

                // Add user message
                this.addUserMessage(message);
                input.value = '';
                input.style.height = 'auto';

                // Disable input while processing
                this.isTyping = true;
                sendBtn.disabled = true;
                this.showTypingIndicator();

                try {
                    // Use Puter.js for real AI responses
                    if (typeof puter !== 'undefined' && puter.ai) {
                        console.log('Using Puter.js AI...');
                        
                        // Create context-aware prompt for coding assistance
                        const codingPrompt = `You are a helpful coding assistant for Medha EduTech students. 
                        Help with programming questions, explain concepts clearly, provide practical examples, and keep responses concise but informative.
                        Focus on Python programming since this is primarily a Python Full Stack course.
                        
                        Student question: ${message}`;

                        const response = await puter.ai.chat(codingPrompt, { 
                            model: "gpt-4.1-nano" 
                        });
                        
                        console.log('Puter AI Response:', response);
                        
                        this.hideTypingIndicator();
                        
                        // Extract the actual message content from the response structure
                        let aiMessage = '';
                        
                        // More robust parsing with multiple checks
                        if (response) {
                            if (response.result && response.result.message && response.result.message.content) {
                                aiMessage = response.result.message.content;
                            } else if (response.message && response.message.content) {
                                aiMessage = response.message.content;
                            } else if (response.content) {
                                aiMessage = response.content;
                            } else if (typeof response === 'string') {
                                aiMessage = response;
                            } else {
                                // Debug: Log the actual structure we received
                                console.error('Unexpected response structure:', JSON.stringify(response, null, 2));
                                aiMessage = 'I received a response but couldn\'t parse it properly. Please try again.';
                            }
                        } else {
                            aiMessage = 'No response received from the AI service.';
                        }
                        
                        console.log('Extracted AI message:', aiMessage);
                        this.addAssistantMessage(aiMessage);
                        
                    } else {
                        throw new Error('Puter.js not available');
                    }
                } catch (error) {
                    console.error('Error calling Puter AI:', error);
                    this.hideTypingIndicator();
                    this.addAssistantMessage("Sorry, I'm having trouble connecting to the AI service right now. Please try again in a moment.");
                }

                // Re-enable input
                this.isTyping = false;
                sendBtn.disabled = false;
            }

            getSampleQuestions() {
                return {
                    python_fullstack: [
                        {
                            id: 1,
                            title: "Two Sum Problem",
                            description: "Given an array of integers and a target sum, return indices of two numbers that add up to the target.",
                            difficulty: "easy",
                            tags: ["Array", "Hash Table", "Two Pointers"],
                            course: "python_fullstack"
                        },
                        {
                            id: 2,
                            title: "Flask API Creation",
                            description: "Create a RESTful API using Flask with CRUD operations for a user management system.",
                            difficulty: "medium",
                            tags: ["Flask", "API", "REST", "Backend"],
                            course: "python_fullstack"
                        },
                        {
                            id: 3,
                            title: "Database Optimization",
                            description: "Optimize database queries and implement proper indexing for a high-traffic web application.",
                            difficulty: "hard",
                            tags: ["Database", "SQL", "Performance", "Optimization"],
                            course: "python_fullstack"
                        },
                        {
                            id: 4,
                            title: "Django Models & ORM",
                            description: "Design and implement Django models with complex relationships and custom managers.",
                            difficulty: "medium",
                            tags: ["Django", "ORM", "Models", "Database"],
                            course: "python_fullstack"
                        },
                        {
                            id: 5,
                            title: "React Component Integration",
                            description: "Integrate React frontend with Python backend API using proper state management.",
                            difficulty: "medium",
                            tags: ["React", "Frontend", "Integration", "State Management"],
                            course: "python_fullstack"
                        }
                    ],
                    digital_marketing: [
                        {
                            id: 6,
                            title: "Google Analytics Dashboard",
                            description: "Create a Python script to automate Google Analytics reporting and visualization.",
                            difficulty: "easy",
                            tags: ["Analytics", "Automation", "API", "Data Visualization"],
                            course: "digital_marketing"
                        },
                        {
                            id: 7,
                            title: "Social Media Sentiment Analysis",
                            description: "Build a tool to analyze sentiment of social media posts using Python and NLP libraries.",
                            difficulty: "medium",
                            tags: ["NLP", "Sentiment Analysis", "Social Media", "Machine Learning"],
                            course: "digital_marketing"
                        },
                        {
                            id: 8,
                            title: "Campaign ROI Calculator",
                            description: "Develop a comprehensive ROI calculator for digital marketing campaigns with multiple channels.",
                            difficulty: "hard",
                            tags: ["ROI", "Marketing Analytics", "Business Logic", "Calculations"],
                            course: "digital_marketing"
                        }
                    ],
                    cybersecurity: [
                        {
                            id: 9,
                            title: "Password Strength Checker",
                            description: "Implement a robust password strength checker with entropy calculation and common password detection.",
                            difficulty: "easy",
                            tags: ["Security", "Validation", "Cryptography", "Best Practices"],
                            course: "cybersecurity"
                        },
                        {
                            id: 10,
                            title: "Network Traffic Analyzer",
                            description: "Build a network traffic analyzer to detect suspicious patterns and potential security threats.",
                            difficulty: "hard",
                            tags: ["Network Security", "Traffic Analysis", "Threat Detection", "Monitoring"],
                            course: "cybersecurity"
                        },
                        {
                            id: 11,
                            title: "Encryption/Decryption Tool",
                            description: "Create a tool for file encryption and decryption using industry-standard algorithms.",
                            difficulty: "medium",
                            tags: ["Cryptography", "File Security", "Algorithms", "Data Protection"],
                            course: "cybersecurity"
                        }
                    ],
                    java_fullstack: [
                        {
                            id: 12,
                            title: "Spring Boot REST API",
                            description: "Develop a complete REST API using Spring Boot with authentication and authorization.",
                            difficulty: "medium",
                            tags: ["Spring Boot", "REST API", "Authentication", "Java"],
                            course: "java_fullstack"
                        },
                        {
                            id: 13,
                            title: "Microservices Architecture",
                            description: "Design and implement a microservices architecture with service discovery and load balancing.",
                            difficulty: "hard",
                            tags: ["Microservices", "Architecture", "Spring Cloud", "Distributed Systems"],
                            course: "java_fullstack"
                        },
                        {
                            id: 14,
                            title: "JPA Query Optimization",
                            description: "Optimize JPA queries and implement efficient data access patterns for large datasets.",
                            difficulty: "medium",
                            tags: ["JPA", "Hibernate", "Database", "Performance"],
                            course: "java_fullstack"
                        }
                    ],
                    data_science: [
                        {
                            id: 15,
                            title: "Data Cleaning Pipeline",
                            description: "Build an automated data cleaning pipeline for messy datasets with pandas and numpy.",
                            difficulty: "easy",
                            tags: ["Data Cleaning", "Pandas", "NumPy", "ETL"],
                            course: "data_science"
                        },
                        {
                            id: 16,
                            title: "Machine Learning Model",
                            description: "Implement and evaluate multiple ML models for a classification problem with proper validation.",
                            difficulty: "hard",
                            tags: ["Machine Learning", "Classification", "Model Evaluation", "Scikit-learn"],
                            course: "data_science"
                        },
                        {
                            id: 17,
                            title: "Time Series Forecasting",
                            description: "Develop a time series forecasting model using LSTM networks for stock price prediction.",
                            difficulty: "hard",
                            tags: ["Time Series", "LSTM", "Deep Learning", "Forecasting"],
                            course: "data_science"
                        }
                    ],
                    data_analytics: [
                        {
                            id: 18,
                            title: "Sales Dashboard Creation",
                            description: "Create an interactive sales dashboard using Plotly and Streamlit with real-time data updates.",
                            difficulty: "medium",
                            tags: ["Dashboard", "Plotly", "Streamlit", "Visualization"],
                            course: "data_analytics"
                        },
                        {
                            id: 19,
                            title: "Customer Segmentation",
                            description: "Perform customer segmentation analysis using clustering algorithms and create actionable insights.",
                            difficulty: "medium",
                            tags: ["Clustering", "Customer Analysis", "Segmentation", "Business Intelligence"],
                            course: "data_analytics"
                        },
                        {
                            id: 20,
                            title: "A/B Test Analysis",
                            description: "Design and analyze A/B tests with proper statistical significance testing and reporting.",
                            difficulty: "hard",
                            tags: ["A/B Testing", "Statistics", "Hypothesis Testing", "Experimentation"],
                            course: "data_analytics"
                        }
                    ]
                };
            }

            loadQuestionsByCourse(course) {
                const questionsList = document.getElementById('questions-list');
                
                if (!course || course === '') {
                    questionsList.innerHTML = `
                        <div class="empty-state">
                            <svg class="empty-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0L19.2 12l-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/>
                            </svg>
                            <h3 class="empty-title">Select a Course</h3>
                            <p class="empty-description">Choose a course from the dropdown above to view coding questions and start practicing.</p>
                        </div>
                    `;
                    return;
                }

                let questionsToShow = [];
                
                if (course === 'all') {
                    // Show all questions from all courses
                    Object.values(this.questions).forEach(courseQuestions => {
                        questionsToShow = questionsToShow.concat(courseQuestions);
                    });
                } else {
                    // Show questions for specific course
                    questionsToShow = this.questions[course] || [];
                }

                if (questionsToShow.length === 0) {
                    questionsList.innerHTML = `
                        <div class="empty-state">
                            <svg class="empty-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                            <h3 class="empty-title">No Questions Available</h3>
                            <p class="empty-description">Questions for this course are coming soon. Check back later!</p>
                        </div>
                    `;
                    return;
                }

                // Render questions
                questionsList.innerHTML = questionsToShow.map(question => `
                    <div class="question-card" onclick="selectQuestion(${question.id})" data-question-id="${question.id}">
                        <div class="question-difficulty difficulty-${question.difficulty}">
                            ${question.difficulty}
                        </div>
                        <h4 class="question-title">${question.title}</h4>
                        <p class="question-description">${question.description}</p>
                        <div class="question-tags">
                            ${question.tags.map(tag => `<span class="question-tag">${tag}</span>`).join('')}
                        </div>
                    </div>
                `).join('');
            }

            selectQuestion(questionId) {
                // Remove previous selection
                document.querySelectorAll('.question-card').forEach(card => {
                    card.classList.remove('selected');
                });

                // Add selection to clicked card
                const selectedCard = document.querySelector(`[data-question-id="${questionId}"]`);
                if (selectedCard) {
                    selectedCard.classList.add('selected');
                }

                // Find the question data
                let foundQuestion = null;
                Object.values(this.questions).forEach(courseQuestions => {
                    const question = courseQuestions.find(q => q.id === questionId);
                    if (question) {
                        foundQuestion = question;
                    }
                });

                if (foundQuestion) {
                    this.selectedQuestion = foundQuestion;
                    this.updateContentTitle(foundQuestion);
                }
            }

            updateContentTitle(question) {
                const contentTitle = document.querySelector('.content-title');
                if (question) {
                    contentTitle.textContent = `Learning Platform - ${question.title}`;
                } else {
                    contentTitle.textContent = 'Learning Platform';
                }
            }
        }

        // Global functions
        function selectQuestion(questionId) {
            window.medhaCode.selectQuestion(questionId);
        }

        function switchTab(tabName) {
            window.medhaCode.switchTab(tabName);
        }

        function sendMessage() {
            window.medhaCode.sendMessage();
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            window.medhaCode = new MedhaCode();
        });
    </script>
</body>
</html>